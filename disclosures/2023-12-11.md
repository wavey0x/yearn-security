# Incident disclosure - 2023-12-11

## Summary
During a regular fee token conversion process on behalf of Yearn's treasury, a faulty multisig script caused Yearn's entire treasury balance of 3,794,894 lp-yCRVv2 tokens to be swapped. This amount was strictly protocol owned liquidity (POL) belonging to Yearn's treasury and does not contain any user funds. This amount comprised a large portion of the Curve pool, and therefore incurred significant slippage which arbed back to the normal price by the market shortly after.

When factoring in the 779,958 yvDAI tokens received from this trade, the total loss experienced by Yearn's treasury comes out to about 63%.

Given that these tokens are critical to Yearn's yCRV liquidity, we are asking anyone who profitably arbed this mistake to return an amount that they feel is reasonable to Yearn's main multisig `ychad.eth`.

## Background
- One of Yearn's leading products, yCRV, is a liquid locker token representing 1 locked CRV in Yearn's pooled veCRV position. 
- Yearn supports this product by maintaining a large amount of protocol owned liquidity, or POL, in its treasury in the form of lp-yCRVv2.
- Separately, Yearn's treasury also recevies lp-yCRVv2 tokens as performance fees on vault harvests which it regularly swaps out of to realize as stablecoins for the treasury operations. 
- The issue stemmed from the entire POL amount being inadvertantly moved to the trading multisig as if it were fees.

## Details of the Issue
- The trading multisig sent a transaction to Cowswap for over 30 orders. [1](#Resources)
- Among these orders was one to swap the entir lp-yCRVv2 balance. 
- Shortly after, the orders were placed, it was filled.

Two major oversights led to this issue:
1. The entire treasury balance of lp-yCRVv2 (POL, plus fees) was mistakenly transferred to the trading multisig, when only expected a much smaller fees portion.
2. The script used by the trading multisig to swap tokens lacked sufficient output checks and contained a logical error that would have capped the trade size to a reasonable amount.

The single transaction queued to the multisig contained over 30 other trades, making it more difficult for human review.

Shortly after the swap, arbitrage bots and other market actors were quick to recover the original price.

### Next Steps
To prevent similar mistakes in the future, a few additional safeguards will be put into place:
- Separate POL funds into dedicated manager contracts
- More human-readable output messages on trading scripts
- Enforce stricter price impact thresholds.

### Resources

1. Cowswap Txn 
https://etherscan.io/tx/0x59d21f6be3cbcfc70e2972c16b1ab62ab292594c6b0e724a337da20350745865
1. Cowswap Order
https://explorer.cow.fi/orders/0xbb9132be67e4f9656beb69877bf43940823ed5c8921b9d6a3b42f0ce4b377c45c001d00d425fa92c4f840baa8f1e0c27c4297a0b65782608?tab=overview
